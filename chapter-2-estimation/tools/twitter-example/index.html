<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twitter Scale Estimation - Step by Step</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; padding: 20px; color: #333;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        .header {
            text-align: center; color: white; margin-bottom: 40px; padding: 40px 20px;
            background: rgba(255,255,255,0.1); border-radius: 20px; backdrop-filter: blur(20px);
        }
        .header h1 { font-size: 2.5rem; margin-bottom: 15px; }
        .estimation-flow { display: flex; flex-direction: column; gap: 30px; }
        .step-card {
            background: rgba(255,255,255,0.95); border-radius: 20px; padding: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1); transition: all 0.3s ease;
            border-left: 5px solid #667eea;
        }
        .step-card.active { border-left-color: #28a745; background: rgba(255,255,255,1); }
        .step-header { display: flex; align-items: center; margin-bottom: 20px; }
        .step-number {
            background: #667eea; color: white; width: 40px; height: 40px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-weight: bold; margin-right: 15px; font-size: 1.2rem;
        }
        .step-title { font-size: 1.5rem; color: #2c3e50; }
        .assumptions-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0; }
        .assumption-card {
            background: #f8f9fa; padding: 20px; border-radius: 10px; border: 1px solid #e2e8f0;
        }
        .assumption-label { font-weight: 600; color: #495057; margin-bottom: 8px; }
        .assumption-input {
            width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 6px;
            font-size: 16px; transition: border-color 0.3s ease;
        }
        .assumption-input:focus { outline: none; border-color: #667eea; }
        .calculation-section { background: #e3f2fd; padding: 20px; border-radius: 10px; margin: 20px 0; }
        .calculation-title { font-size: 1.2rem; color: #1565c0; margin-bottom: 15px; font-weight: 600; }
        .calculation-step { margin: 10px 0; font-family: monospace; background: white; padding: 10px; border-radius: 6px; }
        .result-highlight { background: #c8e6c9; border-left: 4px solid #4caf50; padding: 15px; border-radius: 6px; margin: 15px 0; }
        .calculate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; border: none; padding: 15px 30px; border-radius: 10px;
            font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;
            margin: 20px 0;
        }
        .calculate-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3); }
        .summary-section { background: white; border-radius: 15px; padding: 25px; margin-top: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .summary-title { font-size: 1.8rem; color: #2c3e50; margin-bottom: 20px; text-align: center; }
        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0; }
        .metric-card { background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center; }
        .metric-value { font-size: 2rem; font-weight: bold; color: #667eea; margin-bottom: 5px; }
        .metric-label { color: #666; font-size: 0.9rem; }
        .notes-section { background: #fff3cd; border: 1px solid #ffeaa7; padding: 20px; border-radius: 10px; margin: 20px 0; }
        .visualization { margin: 20px 0; }
        .timeline-bar { height: 30px; background: #e2e8f0; border-radius: 15px; overflow: hidden; position: relative; margin: 10px 0; }
        .timeline-fill { height: 100%; background: linear-gradient(90deg, #667eea, #764ba2); transition: width 1s ease; }
        .timeline-label { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-weight: 600; color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Twitter Scale Estimation</h1>
            <p>Step-by-step back-of-the-envelope calculation following Alex Xu's methodology</p>
        </div>

        <div class="estimation-flow">
            <!-- Step 1: Assumptions -->
            <div class="step-card" id="step1">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <div class="step-title">Define Assumptions</div>
                </div>
                <p style="margin-bottom: 20px; color: #666;">Start with reasonable assumptions about user behavior and system constraints.</p>
                
                <div class="assumptions-grid">
                    <div class="assumption-card">
                        <div class="assumption-label">Monthly Active Users (MAU)</div>
                        <input type="number" class="assumption-input" id="mau" value="300" placeholder="300">
                        <small style="color: #666;">Million users</small>
                    </div>
                    <div class="assumption-card">
                        <div class="assumption-label">Daily Active Users (%)</div>
                        <input type="number" class="assumption-input" id="dau-percent" value="50" placeholder="50">
                        <small style="color: #666;">% of MAU active daily</small>
                    </div>
                    <div class="assumption-card">
                        <div class="assumption-label">Tweets per User per Day</div>
                        <input type="number" class="assumption-input" id="tweets-per-user" value="2" placeholder="2">
                        <small style="color: #666;">Average tweets posted</small>
                    </div>
                    <div class="assumption-card">
                        <div class="assumption-label">Tweets with Media (%)</div>
                        <input type="number" class="assumption-input" id="media-percent" value="10" placeholder="10">
                        <small style="color: #666;">% containing images/video</small>
                    </div>
                    <div class="assumption-card">
                        <div class="assumption-label">Media Retention (Years)</div>
                        <input type="number" class="assumption-input" id="retention-years" value="5" placeholder="5">
                        <small style="color: #666;">Years to keep media</small>
                    </div>
                    <div class="assumption-card">
                        <div class="assumption-label">Average Media Size (MB)</div>
                        <input type="number" class="assumption-input" id="media-size" value="1" placeholder="1">
                        <small style="color: #666;">MB per media file</small>
                    </div>
                </div>
                
                <button class="calculate-btn" onclick="calculateDAU()">Calculate DAU →</button>
                
                <div class="calculation-section" id="dau-calculation" style="display: none;">
                    <div class="calculation-title">Daily Active Users Calculation</div>
                    <div class="calculation-step" id="dau-formula"></div>
                    <div class="result-highlight" id="dau-result"></div>
                </div>
            </div>

            <!-- Step 2: QPS Calculation -->
            <div class="step-card" id="step2">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <div class="step-title">Calculate QPS (Queries Per Second)</div>
                </div>
                <p style="margin-bottom: 20px; color: #666;">Estimate tweet creation rate and peak load factors.</p>
                
                <button class="calculate-btn" onclick="calculateQPS()">Calculate Tweet QPS →</button>
                
                <div class="calculation-section" id="qps-calculation" style="display: none;">
                    <div class="calculation-title">Tweet QPS Calculation</div>
                    <div class="calculation-step" id="qps-formula"></div>
                    <div class="calculation-step" id="peak-qps-formula"></div>
                    <div class="result-highlight" id="qps-result"></div>
                </div>

                <div class="notes-section">
                    <strong>Peak Load Considerations:</strong>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>Peak QPS is typically 2-5x average QPS</li>
                        <li>Events like breaking news can cause 10x+ spikes</li>
                        <li>Regional time zones affect peak distribution</li>
                    </ul>
                </div>
            </div>

            <!-- Step 3: Storage Estimation -->
            <div class="step-card" id="step3">
                <div class="step-header">
                    <div class="step-number">3</div>
                    <div class="step-title">Estimate Storage Requirements</div>
                </div>
                <p style="margin-bottom: 20px; color: #666;">Calculate text and media storage needs over time.</p>
                
                <button class="calculate-btn" onclick="calculateStorage()">Calculate Storage →</button>
                
                <div class="calculation-section" id="storage-calculation" style="display: none;">
                    <div class="calculation-title">Storage Breakdown</div>
                    <div class="calculation-step" id="text-storage-formula"></div>
                    <div class="calculation-step" id="media-storage-formula"></div>
                    <div class="calculation-step" id="total-storage-formula"></div>
                    <div class="result-highlight" id="storage-result"></div>
                </div>

                <div class="visualization" id="storage-visualization" style="display: none;">
                    <h4>Storage Growth Over Time</h4>
                    <div id="storage-timeline"></div>
                </div>
            </div>

            <!-- Step 4: System Requirements -->
            <div class="step-card" id="step4">
                <div class="step-header">
                    <div class="step-number">4</div>
                    <div class="step-title">System Requirements Summary</div>
                </div>
                <p style="margin-bottom: 20px; color: #666;">High-level system design requirements based on calculations.</p>
                
                <button class="calculate-btn" onclick="generateSummary()">Generate Complete Summary →</button>
                
                <div class="summary-section" id="final-summary" style="display: none;">
                    <div class="summary-title">Twitter Scale System Requirements</div>
                    
                    <div class="metrics-grid" id="summary-metrics"></div>
                    
                    <div class="notes-section">
                        <h4>Key Design Considerations</h4>
                        <div id="design-notes"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let calculations = {};

        function calculateDAU() {
            const mau = parseFloat(document.getElementById('mau').value);
            const dauPercent = parseFloat(document.getElementById('dau-percent').value);
            
            const dau = (mau * dauPercent / 100).toFixed(0);
            calculations.mau = mau;
            calculations.dauPercent = dauPercent;
            calculations.dau = parseFloat(dau);
            
            document.getElementById('dau-formula').innerHTML = `
                DAU = MAU × DAU Rate<br>
                DAU = ${mau}M × ${dauPercent}% = ${mau}M × ${dauPercent/100} = ${dau}M
            `;
            
            document.getElementById('dau-result').innerHTML = `
                <strong>Daily Active Users: ${dau} Million</strong>
            `;
            
            document.getElementById('dau-calculation').style.display = 'block';
            document.getElementById('step1').classList.add('active');
        }

        function calculateQPS() {
            if (!calculations.dau) {
                alert('Please calculate DAU first');
                return;
            }
            
            const tweetsPerUser = parseFloat(document.getElementById('tweets-per-user').value);
            const dauInActual = calculations.dau * 1000000; // Convert to actual number
            
            const tweetsPerDay = dauInActual * tweetsPerUser;
            const tweetsPerSecond = tweetsPerDay / 86400; // 86400 seconds in a day
            const peakQPS = tweetsPerSecond * 2; // 2x for peak
            
            calculations.tweetsPerUser = tweetsPerUser;
            calculations.tweetsPerDay = tweetsPerDay;
            calculations.avgQPS = tweetsPerSecond;
            calculations.peakQPS = peakQPS;
            
            document.getElementById('qps-formula').innerHTML = `
                Tweets per Day = DAU × Tweets per User<br>
                Tweets per Day = ${calculations.dau}M × ${tweetsPerUser} = ${(tweetsPerDay/1000000).toFixed(0)}M tweets/day<br><br>
                Average QPS = Tweets per Day ÷ 86,400 seconds<br>
                Average QPS = ${(tweetsPerDay/1000000).toFixed(0)}M ÷ 86,400 = ${tweetsPerSecond.toFixed(0)} tweets/second
            `;
            
            document.getElementById('peak-qps-formula').innerHTML = `
                Peak QPS = Average QPS × 2 (peak factor)<br>
                Peak QPS = ${tweetsPerSecond.toFixed(0)} × 2 = ${peakQPS.toFixed(0)} tweets/second
            `;
            
            document.getElementById('qps-result').innerHTML = `
                <strong>Average QPS: ${tweetsPerSecond.toFixed(0)} tweets/second</strong><br>
                <strong>Peak QPS: ${peakQPS.toFixed(0)} tweets/second</strong>
            `;
            
            document.getElementById('qps-calculation').style.display = 'block';
            document.getElementById('step2').classList.add('active');
        }

        function calculateStorage() {
            if (!calculations.tweetsPerDay) {
                alert('Please calculate QPS first');
                return;
            }
            
            const mediaPercent = parseFloat(document.getElementById('media-percent').value);
            const retentionYears = parseFloat(document.getElementById('retention-years').value);
            const mediaSizeMB = parseFloat(document.getElementById('media-size').value);
            
            // Text storage (assume 300 bytes per tweet including metadata)
            const bytesPerTweet = 300;
            const dailyTextStorage = calculations.tweetsPerDay * bytesPerTweet;
            const yearlyTextStorageGB = (dailyTextStorage * 365) / (1024 * 1024 * 1024);
            const totalTextStorageGB = yearlyTextStorageGB * retentionYears;
            
            // Media storage
            const tweetsWithMedia = calculations.tweetsPerDay * (mediaPercent / 100);
            const dailyMediaStorageGB = (tweetsWithMedia * mediaSizeMB) / 1024;
            const yearlyMediaStorageGB = dailyMediaStorageGB * 365;
            const totalMediaStorageGB = yearlyMediaStorageGB * retentionYears;
            
            const totalStorageGB = totalTextStorageGB + totalMediaStorageGB;
            const totalStoragePB = totalStorageGB / (1024 * 1024);
            
            calculations.mediaPercent = mediaPercent;
            calculations.retentionYears = retentionYears;
            calculations.mediaSizeMB = mediaSizeMB;
            calculations.dailyTextStorageGB = dailyTextStorage / (1024 * 1024 * 1024);
            calculations.dailyMediaStorageGB = dailyMediaStorageGB;
            calculations.totalStoragePB = totalStoragePB;
            
            document.getElementById('text-storage-formula').innerHTML = `
                Text Storage per Tweet = 300 bytes (including metadata)<br>
                Daily Text Storage = ${(calculations.tweetsPerDay/1000000).toFixed(0)}M tweets × 300 bytes = ${(dailyTextStorage/1000000000).toFixed(1)}GB/day<br>
                Total Text Storage (${retentionYears} years) = ${(dailyTextStorage/1000000000).toFixed(1)}GB × 365 × ${retentionYears} = ${totalTextStorageGB.toFixed(0)}GB
            `;
            
            document.getElementById('media-storage-formula').innerHTML = `
                Tweets with Media = ${(calculations.tweetsPerDay/1000000).toFixed(0)}M × ${mediaPercent}% = ${(tweetsWithMedia/1000000).toFixed(1)}M/day<br>
                Daily Media Storage = ${(tweetsWithMedia/1000000).toFixed(1)}M × ${mediaSizeMB}MB = ${dailyMediaStorageGB.toFixed(0)}GB/day<br>
                Total Media Storage (${retentionYears} years) = ${dailyMediaStorageGB.toFixed(0)}GB × 365 × ${retentionYears} = ${totalMediaStorageGB.toFixed(0)}GB
            `;
            
            document.getElementById('total-storage-formula').innerHTML = `
                Total Storage = Text Storage + Media Storage<br>
                Total Storage = ${totalTextStorageGB.toFixed(0)}GB + ${totalMediaStorageGB.toFixed(0)}GB = ${totalStorageGB.toFixed(0)}GB<br>
                Total Storage = ${totalStoragePB.toFixed(1)} PB
            `;
            
            document.getElementById('storage-result').innerHTML = `
                <strong>Total Storage Required: ${totalStoragePB.toFixed(1)} PB over ${retentionYears} years</strong><br>
                <strong>Daily Growth: ${(dailyMediaStorageGB + calculations.dailyTextStorageGB).toFixed(1)} GB/day</strong>
            `;
            
            document.getElementById('storage-calculation').style.display = 'block';
            
            // Create storage visualization
            createStorageVisualization(retentionYears, dailyMediaStorageGB + calculations.dailyTextStorageGB);
            document.getElementById('storage-visualization').style.display = 'block';
            document.getElementById('step3').classList.add('active');
        }

        function createStorageVisualization(years, dailyGrowthGB) {
            const timelineDiv = document.getElementById('storage-timeline');
            let html = '';
            
            for (let year = 1; year <= years; year++) {
                const totalGB = dailyGrowthGB * 365 * year;
                const totalTB = totalGB / 1024;
                const percentage = (year / years) * 100;
                
                html += `
                    <div style="margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>Year ${year}</span>
                            <span>${totalTB.toFixed(1)} TB</span>
                        </div>
                        <div class="timeline-bar">
                            <div class="timeline-fill" style="width: ${percentage}%;"></div>
                        </div>
                    </div>
                `;
            }
            
            timelineDiv.innerHTML = html;
        }

        function generateSummary() {
            if (!calculations.totalStoragePB) {
                alert('Please complete all calculation steps first');
                return;
            }
            
            const metricsDiv = document.getElementById('summary-metrics');
            metricsDiv.innerHTML = `
                <div class="metric-card">
                    <div class="metric-value">${calculations.dau}M</div>
                    <div class="metric-label">Daily Active Users</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${calculations.avgQPS.toFixed(0)}</div>
                    <div class="metric-label">Average QPS</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${calculations.peakQPS.toFixed(0)}</div>
                    <div class="metric-label">Peak QPS</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${calculations.totalStoragePB.toFixed(1)} PB</div>
                    <div class="metric-label">Total Storage (5 years)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${(calculations.dailyMediaStorageGB + calculations.dailyTextStorageGB).toFixed(0)} GB</div>
                    <div class="metric-label">Daily Storage Growth</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${(calculations.tweetsPerDay/1000000).toFixed(0)}M</div>
                    <div class="metric-label">Tweets per Day</div>
                </div>
            `;
            
            const designNotesDiv = document.getElementById('design-notes');
            designNotesDiv.innerHTML = `
                <ul style="margin-left: 20px;">
                    <li><strong>Database:</strong> Needs to handle ${calculations.peakQPS.toFixed(0)} writes/second at peak</li>
                    <li><strong>Storage:</strong> Distributed storage system for ${calculations.totalStoragePB.toFixed(1)} PB capacity</li>
                    <li><strong>CDN:</strong> Essential for media delivery (${calculations.mediaPercent}% of tweets have media)</li>
                    <li><strong>Caching:</strong> Redis/Memcached for hot data and timeline generation</li>
                    <li><strong>Load Balancing:</strong> Multiple servers to handle ${calculations.avgQPS.toFixed(0)} average QPS</li>
                    <li><strong>Monitoring:</strong> Real-time alerts for traffic spikes above ${calculations.peakQPS.toFixed(0)} QPS</li>
                </ul>
            `;
            
            document.getElementById('final-summary').style.display = 'block';
            document.getElementById('step4').classList.add('active');
        }

        // Auto-recalculate when assumptions change
        document.querySelectorAll('.assumption-input').forEach(input => {
            input.addEventListener('change', () => {
                // Reset calculations when assumptions change
                calculations = {};
                document.querySelectorAll('.step-card').forEach(card => card.classList.remove('active'));
                document.querySelectorAll('.calculation-section, .summary-section, .visualization').forEach(section => {
                    section.style.display = 'none';
                });
            });
        });
    </script>
</body>
</html>